# Lighthouse를 이용하여 Web Vital 진단 및 최적화를 진행 ✨

## Lighthouse

Google Chrome에서 제공하는, 웹앱의 품질 개선에 도움을 주는 자동화 도구.
성능, 접근성, SEO 등 사이트에 대한 전반적인 진단

## Lighthouse의 6가지 지표

### 1. FCP

First Contentful Paint
: 초기 DOM 콘텐츠를 렌더링하는데 걸리는 시간

- 첫번째 텍스트 또는 이미지가 표시되는 시간
- FCP 측정 시점을 시작점으로 하는 다른 Metric들이 있기에, 가장 먼저 찍히는 FCP는 다른 항목들의 점수 및 전체 점수에 큰 영향을 줌

### 2. SI

Speed Index
: 콘텐츠가 시각적으로 표시되는 진행 속도를 측정
리로드되는 페이지의 비디오를 캡쳐하여 프레임 간의 속도를 계산

> **SI 점수를 높이는 방법**
>
> - 메인 스레드 작업 최소화
> - Javascript 실행 시간 단축
> - 폰트가 로드되는 중에도 텍스트가 계속 표시

### 3. LCP

Largest Contentful Paint
: 가장 큰 콘텐츠를 렌더링 하는데 걸리는 시간.
보통 중요한 콘텐츠일수록 크기가 크기 때문에, Lighthouse는 LCP 점수에 가장 높은 가중치인 25%를 주어 계산

> **LCP의 크키로 간주 요소**
>
> - <img> 요소
> - <svg> 요소
> - <video> 요소
> - background-image 속성의 url()로 로드되는 요소
> - block 레벨 요소 (elements containing text nodes or other inline-level text elements children)

#### LCP의 크기로 간주되려면?

일반적으로 뷰포트(viewport) 내에서 사용자에게 표시되는 요소 중 가장 크기가 큰 요소로 결정

### 4. TTI

Time to Interactive
: 사용자가 페이지와 완전하게 상호작용할 수 있을 때까지 걸리는 시간.
단순히 시각적으로 보여지는 것 뿐만 아니라, 사용자가 페이지와 소통이 가능한 상태까지 렌더링 되어야 함.

예를 들면, 이벤트 핸들러가 가장 눈에 띄는 페이지 요소에 등록되는 시점에는 사용자와 사이트가 상화작용이 가능해졌다고 볼 수 있습니다.

#### TTI 점수를 높이는 방법: JavaScript 실행 시간 최소화

### 5. TBT

Total Blocking Time
: 마우스 클릭, 화면 탭 또는 키보드 누름과 같은 사용자 입력에 페이지가 응답하지 못하도록 차단된 총 시간을 의미.
FCP와 TTI 사이의 모든 Long Task 블로킹 타임을 추가하여 계산

> **TBT 점수를 높이는 방법(= Long Task의 근본적인 원인을 제거하는 방법)**
>
> - 불필요한 JavaScript 로드, 실행 코드 제거
> - 코드 분할을 통해 JavaScript payload 감소시키기
> - 사용하지 않는 코드 삭제

### 6. CLS

Cumulative Layout Shift
: 사용자가 예상치 못한 레이아웃 이동을 경험하는 것에 대한 점수.
레이아웃 불안정이 사용자에게 미치는 부정적인 영향에 대해 검사

## 성능 점수가 변동하는 이유

Lighthouse를 통해 검사를 여러번 실행해보면, 동일한 페이지여도 항상 같은 점수가 나오지 않는다.

Lighthouse팀에서 이야기하는 이유는 점수의 변동성이 검사를 실행하는 근본적인 조건의 변화라고 하고 일반적으로 다음과 같은 문제가 있다.

- A / B 테스트 또는 광고 게시 변경
- 인터넷 트래픽 라우팅 변경
- 고성능 데스크톱 및 저 성능 노트북과 같은 다양한 장치에서 테스트
- JavaScript를 삽입하고 네트워크 요청을 추가/수정하는 브라우저 확장
- 바이러스 백신 소프트웨어

Lighthouse를 실행하는 환경에 따라 점수는 상이하게 나올 수 있고, 이를 제어하기 어렵다.

## 코어 웹 바이탈 (Core Web Vitals)

사이트의 전반적인 로딩 속도, 상호작용, 웹페이지의 시각적 안정성, 보안 문제등 유저들의 사용 경험을 측정하는 구글의 표준화된 측정 항목 집합

### SEO측면에서 코어 웹 바이탈

웹 사이트의 사용자 경험에 직접적인 영향을 끼치기에 검색엔진순위에 영향을 미칠 수 있기 때문

### 측정 항목

1. LCP(Largest Contentful Paint): 콘텐츠 렌더링 시간. 가장 중요한 부분이 로드되는 시점에만 집중. 즉 뷰포트내에서 가장 큰 페이지요소를 표시하는데 걸리는 시간을 측정

2. FID(First Input Delay): 사용자가 웹페이지와 상호작용을 시도하는 첫번째 순간부터 웹페이지가 응답하는 시간 측정. 중요한건 요청받은 액션을 처리하는 시간이 아닌 입력 지연을 시키는 시간.

3. CLS(Cumulative Layout Shift): 페이지가 로드될 떄 페이지가 얼마나 안정적인지 측정하고 '시각적 안정성'을 이루고자 함. 모바일 중심의 지표
